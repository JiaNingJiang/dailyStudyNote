## 1.1  操作系统的运行机制

计算机系统中，通常CPU执行两种不同性质的程序：一种是**操作系统内核程序**；另一种是用户自编程序或系统外层的**应用程序**。对操作系统而言，这两种程序的作用不同，**前者是后者的管理者**，因此**“管理程序”要执行一些特权指令**，而**“被管理程序”出于安全考虑不能执行这些指令**。

![image-20231130220059760](01.操作系统的运行机制和体系结构.assets/image-20231130220059760-170135286132522.png)

操作系统在具体实现上划分了**用户态（目态）**和**核心态（管态）**，以严格区分两类程序。

![image-20231130220225209](01.操作系统的运行机制和体系结构.assets/image-20231130220225209-170135294670423.png)

![image-20231130220449885](01.操作系统的运行机制和体系结构.assets/image-20231130220449885-170135309118424.png)

![image-20231130220619193](01.操作系统的运行机制和体系结构.assets/image-20231130220619193-170135318082625.png)

## 1.2  中断和异常

![image-20231130220801012](01.操作系统的运行机制和体系结构.assets/image-20231130220801012-170135328275626.png)

![image-20231130220836646](01.操作系统的运行机制和体系结构.assets/image-20231130220836646-170135331838827.png)

![在这里插入图片描述](01.操作系统的运行机制和体系结构.assets/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70-17013525905106.png)

![image-20231130221040844](01.操作系统的运行机制和体系结构.assets/image-20231130221040844-170135344211628.png)

![image-20231130221202982](01.操作系统的运行机制和体系结构.assets/image-20231130221202982-170135352430129.png)

![image-20231130221259813](01.操作系统的运行机制和体系结构.assets/image-20231130221259813-170135358152130.png)

![在这里插入图片描述](01.操作系统的运行机制和体系结构.assets/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70-170135260695910.png)

![image-20231130221357559](01.操作系统的运行机制和体系结构.assets/image-20231130221357559-170135363894631.png)



## 1.3  系统调用

![在这里插入图片描述](01.操作系统的运行机制和体系结构.assets/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70-170135263841212.png)

![在这里插入图片描述](01.操作系统的运行机制和体系结构.assets/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70-170135264648514.png)

![在这里插入图片描述](01.操作系统的运行机制和体系结构.assets/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70-170135265471216.png)

![image-20231130221600325](01.操作系统的运行机制和体系结构.assets/image-20231130221600325-170135376181032.png)

![在这里插入图片描述](01.操作系统的运行机制和体系结构.assets/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70-170135267399420.png)

## 1.4   操作系统的体系结构

![image-20231130221804489](01.操作系统的运行机制和体系结构.assets/image-20231130221804489-170135388596534.png)

![image-20231130221830002](01.操作系统的运行机制和体系结构.assets/image-20231130221830002-170135391109135.png)

**操作系统的各项功能**分别被设置在**不同的层次**上。一些**与硬件关联较紧密**的模块，诸如**时钟管理**、**中断处理**、**原语**等处于**最底层**。其次是**运行频率较高的程序**，诸如**进程管理、存储器管理和设备管理**等。这**两部分内容**构成了**操作系统的内核**。这部分内容的**指令操作**工作在**核心态**。

内核是计算机上配置的底层软件，是计算机功能的延伸。不同系统对内核的定义稍有区别。**大多数操作系统内核**包括**四个方面的内容**：

1. **时钟管理**
   在计算机的各种部件中，时钟是最关键的设备。时钟的第一功能是计时，操作系统需要通过时钟管理，向用户提供**标准的系统时间**。另外，通过**时钟中断**的管理，可以**实现进程的切换**。诸如，在分时操作系统中，采用**时间片轮转调度**的实现；在实时系统中，按截止时间控制运行的实现；在批处理系统中，通过时钟管理来衡量一个作业的运行程度等。因此，系统管理的方方面无不依赖于时钟。

2.  **中断机制**
   引入中断技术的初衷是**提高多道程序运行环境中CPU的利用率**，而且**主要是针对外部设备**的。例如，键盘或鼠标信息的输入、进程的管理和调度、系统功能的调用、设备驱动、文件访问等，无不依赖于中断机制。可以说，现代操作系统是靠中断驱动的软件。中断机制中，只有一小部分功能属于内核，负责**保护和恢复中断现场的信息**，**转移控制权到相关的处理程序**。这样可以减少中断的处理时间，提高系统的并行处理能力

3. **原语**

   按层次结构设计的操作系统，底层必然是一些可被调用的公用小程序，它们各自完成一个规定的操作。其特点是：
   1）它们处于操作系统的最底层，是**最接近硬件的部分**。
   2）这些程序的运行具有**原子性**—其**操作只能一气呵成**（这主要是从系统的安全性和便于管理考虑的）
   3）这些程序的**运行时间都较短**，而且**调用频繁**。

   通常把具有这些特点的程序称为原语（ Atomic Operation）.

   定义原语的直接方法是**关闭中断**，让它的**所有动作不可分割地进行完**，**再打开中断**。系统中的设备驱动、CPU切换、进程通信等功能中的部分操作都可以定义为原语，使它们成为内核的组成部分

4. **系统控制的数据结构及处理**

   系统中用来登记状态信息的数据结构很多，比如作业控制块、进程控制（PCB）、设备控制块、各类链表、消息队列、缓冲区、空闲区登记表、内存分配表等。为了实现有效的管理，系统需要一些基本的操作，常见的操作有以下三种：

   1）**进程管理**：进程状态管理、进程调度和分派、创建与撤销进程控制块等
   2）**存储器管理**：存储器的空间分配和回收、内存信息保护程序、代码对换程序等
   3）**设备管理**：缓冲区管理、设备分配和回收等从上述内容可以了解，核心态指令实际上包括系统调用类指令和一些针对时钟、中断和原语的操作指令

### 1.4.1  大内核与微内核

![image-20231130221903162](01.操作系统的运行机制和体系结构.assets/image-20231130221903162-170135394436436.png)

![image-20231130222028200](01.操作系统的运行机制和体系结构.assets/image-20231130222028200-170135402945837.png)

![image-20231130222126492](01.操作系统的运行机制和体系结构.assets/image-20231130222126492-170135408762538.png)

### 1.4.2 分层结构

<img src="01.操作系统的运行机制和体系结构.assets/image-20231130222413319.png" alt="image-20231130222413319" style="zoom:50%;" />

### 1.4.3 模块化

![image-20231130222451209](01.操作系统的运行机制和体系结构.assets/image-20231130222451209-170135429256641.png)

### 1.4.4  外核

<img src="01.操作系统的运行机制和体系结构.assets/image-20231130222616501.png" alt="image-20231130222616501" style="zoom: 33%;" />

### 1.4.5 不同体系结构的优缺点

![image-20231130222244463](01.操作系统的运行机制和体系结构.assets/image-20231130222244463-170135416575239.png)

## 1.5  操作系统的引导

![image-20231130222804565](01.操作系统的运行机制和体系结构.assets/image-20231130222804565-170135448576843.png)

`ROM` 中的数据具有系统断电后不丢失的特性。

<img src="01.操作系统的运行机制和体系结构.assets/image-20231130222931249.png" alt="image-20231130222931249" style="zoom: 50%;" />

## 1.6 虚拟机

<img src="01.操作系统的运行机制和体系结构.assets/image-20231130223000072.png" alt="image-20231130223000072" style="zoom: 50%;" />

![image-20231130223042074](01.操作系统的运行机制和体系结构.assets/image-20231130223042074-170135464332346.png)

![image-20231130223130319](01.操作系统的运行机制和体系结构.assets/image-20231130223130319-170135469135747.png)